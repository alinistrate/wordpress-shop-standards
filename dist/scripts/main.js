/* global jQuery, shop_standards_settings */
(function pageLoad($) {
  // Toggles product filtering by term.
  $('body').on('click', '[data-url]', function (e) {
    var url = $(e.target).data('url') || $(e.target).closest('[data-url]').data('url');

    if (url) {
      document.location.href = url;
    }
  });
  /**
   * Prevents multiple order to be sent.
   *
   * If the page takes time to be loaded, the user could click multiple
   * times on the place order button and this would generate multiple orders.
   * To prevent this we stop form submit event propagation after the first click.
   */

  var placeOrderBtnInitialValue = $('#place_order').prop('value');
  $('#place_order').click(function disableSubmitOrder(e) {
    if ($(this).hasClass('disabled')) {
      e.preventDefault();
      return;
    }

    $('#place_order').prop('value', 'Ihre Bestellung wird jetzt verarbeitetâ€¦').addClass('disabled');
  });
  $(document.body).on('checkout_error', function () {
    $('#place_order').prop('value', placeOrderBtnInitialValue).removeClass('disabled');
  });
  var $variationsForm = $('.variations_form');
  var $variationsSelectDropdowns = $('.variations_form .variations select');
  var $variationSelectChanged = false;
  $variationsSelectDropdowns.change(function variationSelectDropdownChanged() {
    $variationSelectChanged = $(this);
  });
  $('.variations_form').on('woocommerce_variation_has_changed', function () {
    // Allow selecting the default empty value of an attributes dropdown
    // without modifying the value of the others.
    if ($variationSelectChanged && $variationSelectChanged.val() === '') {
      $variationSelectChanged.val('');
      $variationSelectChanged = false;
    } else {
      // If there is only one option left in any of current variation attributes
      // dropdowns, it should be auto-selected.
      $variationsSelectDropdowns.each(function setVariationSelectDropdowns() {
        var $this = $(this);

        if ($this.find('option').size() === 2) {
          $this.val($this.find('option').eq(1).val());
        }
      });
    } // Ensure the rigth product image is displayed.
    // Some delay seems to be needed to refresh the product image.
    // We couldn't find a proper event to hook on, so we used a timeout.


    setTimeout(function () {
      $variationsForm.trigger('check_variations');
    }, 100);
  });
  $('.single_variation_wrap').on('show_variation', function (event, variation) {
    // Updates discount table on product variation change.
    $('[data-variations]').parent().hide();
    $($('[data-variations]')).each(function updateDiscountTable() {
      if ($(this).data('variations').indexOf(variation.variation_id.toString()) !== -1) {
        $(this).parent().show();
      }
    });
  }).on('hide_variation', function () {
    // Hides all variation product discount table on product variation hide.
    $($('[data-variations]')).each(function hideDiscountTable() {
      $(this).parent().hide();
    });
  });
  $(document).ready(function () {
    // Disable copy/paste actions on billing email fields.
    if (shop_standards_settings.emailConfirmationEmail === 'yes') {
      $('#billing_email, #billing_email_confirmation').on('cut copy paste', function (e) {
        e.preventDefault();
      }); // Marks email confirmation field as invalid if does not match email
      // field on form submit.

      $('form.woocommerce-checkout').on('input validate change', function () {
        if ($('#billing_email').val() !== $('#billing_email_confirmation').val()) {
          $('#billing_email_confirmation_field').removeClass('woocommerce-validated').addClass('woocommerce-invalid woocommerce-invalid-required-field');
        }
      });
    }
  }); // Disable checkout button if cart only contains low return products.

  $(document).on('ready updated_cart_totals', function () {
    if ($('.woocommerce-error li[data-plus-product="invalid"]').length) {
      $('.checkout-button').removeAttr('href').addClass('disabled');
      $('.wcppec-checkout-buttons').hide();
    }
  }); // Used and defective goods checkbox agreement related functionality.

  $(document).ready(function () {
    var $usedGoodsConsentCheckbox = $('#used-goods-consent');
    var $usedGoodsConsentContainer = $('.product-defects__checkbox-container');

    if ($usedGoodsConsentCheckbox.length) {
      $(document).on('show_variation', '.single_variation_wrap', function (event, variation) {
        var usedGoodsConsentAttr = variation.used_goods_consent_attribute;
        $('.product-defects__attribute').text(usedGoodsConsentAttr);

        if (usedGoodsConsentAttr) {
          $usedGoodsConsentContainer.show();
          $usedGoodsConsentCheckbox.prop('required', 'required');
        } else {
          $usedGoodsConsentContainer.hide();
          $usedGoodsConsentCheckbox.removeAttr('required');
        }
      });
    }
  }); // Add ajax add to cart

  $(document).ready(function () {
    $('body.custom-ajax-cart-active .single_add_to_cart_button').click(function (e) {
      e.preventDefault();

      if ($(e.target).hasClass('loading')) {
        return;
      }

      var $thisbutton = $(e.target);
      var $form = $thisbutton.closest('form.cart');
      var id = $thisbutton.val();
      var productQty = $form.find('input[name=quantity]').val() || 1;
      var productId = $form.find('input[name=product_id]').val() || id;
      var variationId = $form.find('input[name=variation_id]').val() || 0;
      var productType = $form.hasClass('variations_form') ? 'variable' : 'simple';
      var data = {
        action: 'woocommerceAjaxAddToCart',
        product_id: productId,
        product_sku: '',
        quantity: productQty,
        variation_id: variationId,
        product_type: productType,
        nonce: shop_standards_settings.ajax_nonce
      };
      $.ajax({
        type: 'post',
        url: shop_standards_settings.ajax_url,
        data: data,
        beforeSend: function beforeSend() {
          $thisbutton.addClass('loading');
        },
        complete: function complete() {
          $thisbutton.removeClass('loading');
          $('html, body').animate({
            scrollTop: 0
          }, 500);
        },
        success: function success(response) {
          if (response.error && response.product_url) {
            window.location = response.product_url;
          } else {
            $(document.body).trigger('added_to_cart', [response.fragments, response.cart_hash, $thisbutton]);
            $('.woocommerce-error, .woocommerce-message, .woocommerce-info, .related-accessories').remove();
            $form.closest('.product').before(response.fragments.notices_html);

            if (!$(response.fragments.notices_html).hasClass('woocommerce-error')) {
              $form.closest('.product').before(response.fragments.accessories_html);
              $(document).trigger('reloadRelatedAccessories');
              $(document).trigger('reloadGalleryaSlider');
            }

            if ($('span.header-item--cart__amount').length) {
              $('span.header-item--cart__amount').html($(response.fragments['span.header-item--cart__amount']).html());
            } else {
              $('button.header-item--cart').append($(response.fragments['span.header-item--cart__amount']));
            }
          }
        }
      });
    });
  });
})(jQuery);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicGFnZUxvYWQiLCIkIiwib24iLCJlIiwidXJsIiwidGFyZ2V0IiwiZGF0YSIsImNsb3Nlc3QiLCJkb2N1bWVudCIsImxvY2F0aW9uIiwiaHJlZiIsInBsYWNlT3JkZXJCdG5Jbml0aWFsVmFsdWUiLCJwcm9wIiwiY2xpY2siLCJkaXNhYmxlU3VibWl0T3JkZXIiLCJoYXNDbGFzcyIsInByZXZlbnREZWZhdWx0IiwiYWRkQ2xhc3MiLCJib2R5IiwicmVtb3ZlQ2xhc3MiLCIkdmFyaWF0aW9uc0Zvcm0iLCIkdmFyaWF0aW9uc1NlbGVjdERyb3Bkb3ducyIsIiR2YXJpYXRpb25TZWxlY3RDaGFuZ2VkIiwiY2hhbmdlIiwidmFyaWF0aW9uU2VsZWN0RHJvcGRvd25DaGFuZ2VkIiwidmFsIiwiZWFjaCIsInNldFZhcmlhdGlvblNlbGVjdERyb3Bkb3ducyIsIiR0aGlzIiwiZmluZCIsInNpemUiLCJlcSIsInNldFRpbWVvdXQiLCJ0cmlnZ2VyIiwiZXZlbnQiLCJ2YXJpYXRpb24iLCJwYXJlbnQiLCJoaWRlIiwidXBkYXRlRGlzY291bnRUYWJsZSIsImluZGV4T2YiLCJ2YXJpYXRpb25faWQiLCJ0b1N0cmluZyIsInNob3ciLCJoaWRlRGlzY291bnRUYWJsZSIsInJlYWR5Iiwic2hvcF9zdGFuZGFyZHNfc2V0dGluZ3MiLCJlbWFpbENvbmZpcm1hdGlvbkVtYWlsIiwibGVuZ3RoIiwicmVtb3ZlQXR0ciIsIiR1c2VkR29vZHNDb25zZW50Q2hlY2tib3giLCIkdXNlZEdvb2RzQ29uc2VudENvbnRhaW5lciIsInVzZWRHb29kc0NvbnNlbnRBdHRyIiwidXNlZF9nb29kc19jb25zZW50X2F0dHJpYnV0ZSIsInRleHQiLCIkdGhpc2J1dHRvbiIsIiRmb3JtIiwiaWQiLCJwcm9kdWN0UXR5IiwicHJvZHVjdElkIiwidmFyaWF0aW9uSWQiLCJwcm9kdWN0VHlwZSIsImFjdGlvbiIsInByb2R1Y3RfaWQiLCJwcm9kdWN0X3NrdSIsInF1YW50aXR5IiwicHJvZHVjdF90eXBlIiwibm9uY2UiLCJhamF4X25vbmNlIiwiYWpheCIsInR5cGUiLCJhamF4X3VybCIsImJlZm9yZVNlbmQiLCJjb21wbGV0ZSIsImFuaW1hdGUiLCJzY3JvbGxUb3AiLCJzdWNjZXNzIiwicmVzcG9uc2UiLCJlcnJvciIsInByb2R1Y3RfdXJsIiwid2luZG93IiwiZnJhZ21lbnRzIiwiY2FydF9oYXNoIiwicmVtb3ZlIiwiYmVmb3JlIiwibm90aWNlc19odG1sIiwiYWNjZXNzb3JpZXNfaHRtbCIsImh0bWwiLCJhcHBlbmQiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJBQUFBO0FBRUMsVUFBU0EsUUFBVCxDQUFrQkMsQ0FBbEIsRUFBcUI7QUFDcEI7QUFDQUEsRUFBQUEsQ0FBQyxDQUFDLE1BQUQsQ0FBRCxDQUNHQyxFQURILENBRUksT0FGSixFQUdJLFlBSEosRUFJSSxVQUFDQyxDQUFELEVBQU87QUFDTCxRQUFNQyxHQUFHLEdBQUdILENBQUMsQ0FBQ0UsQ0FBQyxDQUFDRSxNQUFILENBQUQsQ0FBWUMsSUFBWixDQUFpQixLQUFqQixLQUEyQkwsQ0FBQyxDQUFDRSxDQUFDLENBQUNFLE1BQUgsQ0FBRCxDQUFZRSxPQUFaLENBQW9CLFlBQXBCLEVBQWtDRCxJQUFsQyxDQUF1QyxLQUF2QyxDQUF2Qzs7QUFDQSxRQUFJRixHQUFKLEVBQVM7QUFDUEksTUFBQUEsUUFBUSxDQUFDQyxRQUFULENBQWtCQyxJQUFsQixHQUF5Qk4sR0FBekI7QUFDRDtBQUNGLEdBVEw7QUFZQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFRSxNQUFNTyx5QkFBeUIsR0FBR1YsQ0FBQyxDQUFDLGNBQUQsQ0FBRCxDQUFrQlcsSUFBbEIsQ0FBdUIsT0FBdkIsQ0FBbEM7QUFDQVgsRUFBQUEsQ0FBQyxDQUFDLGNBQUQsQ0FBRCxDQUFrQlksS0FBbEIsQ0FBd0IsU0FBU0Msa0JBQVQsQ0FBNEJYLENBQTVCLEVBQStCO0FBQ3JELFFBQUlGLENBQUMsQ0FBQyxJQUFELENBQUQsQ0FB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QUFwRDtBQUNBcEYsY0FBQUEsQ0FBQyxDQUFDTyxRQUFELENBQUQsQ0FBWXlCLE9BQVosQ0FBb0IsMEJBQXBCO0FBQ0FoQyxjQUFBQSxDQUFDLENBQUNPLFFBQUQsQ0FBRCxDQUFZeUIsT0FBWixDQUFvQixzQkFBcEI7QUFDRDs7QUFDRCxnQkFBSWhDLENBQUMsQ0FBQyxnQ0FBRCxDQUFELENBQW9DOEMsTUFBeEMsRUFBZ0Q7QUFDOUM5QyxjQUFBQSxDQUFDLENBQUMsZ0NBQUQsQ0FBRCxDQUFvQ3FGLElBQXBDLENBQXlDckYsQ0FBQyxDQUFDMkUsUUFBUSxDQUFDSSxTQUFULENBQW1CLGdDQUFuQixDQUFELENBQUQsQ0FBd0RNLElBQXhELEVBQXpDO0FBQ0QsYUFGRCxNQUVPO0FBQ0xyRixjQUFBQSxDQUFDLENBQUMsMEJBQUQsQ0FBRCxDQUE4QnNGLE1BQTlCLENBQXFDdEYsQ0FBQyxDQUFDMkUsUUFBUSxDQUFDSSxTQUFULENBQW1CLGdDQUFuQixDQUFELENBQXRDO0FBQ0Q7QUFDRjtBQUNGO0FBL0JJLE9BQVA7QUFpQ0QsS0F0REQ7QUF1REQsR0F4REQ7QUF5REQsQ0ExTEEsRUEwTENRLE1BMUxELENBQUQiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgalF1ZXJ5LCBzaG9wX3N0YW5kYXJkc19zZXR0aW5ncyAqL1xuXG4oZnVuY3Rpb24gcGFnZUxvYWQoJCkge1xuICAvLyBUb2dnbGVzIHByb2R1Y3QgZmlsdGVyaW5nIGJ5IHRlcm0uXG4gICQoJ2JvZHknKVxuICAgIC5vbihcbiAgICAgICdjbGljaycsXG4gICAgICAnW2RhdGEtdXJsXScsXG4gICAgICAoZSkgPT4ge1xuICAgICAgICBjb25zdCB1cmwgPSAkKGUudGFyZ2V0KS5kYXRhKCd1cmwnKSB8fCAkKGUudGFyZ2V0KS5jbG9zZXN0KCdbZGF0YS11cmxdJykuZGF0YSgndXJsJyk7XG4gICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gdXJsO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICk7XG5cbiAgLyoqXG4gICAqIFByZXZlbnRzIG11bHRpcGxlIG9yZGVyIHRvIGJlIHNlbnQuXG4gICAqXG4gICAqIElmIHRoZSBwYWdlIHRha2VzIHRpbWUgdG8gYmUgbG9hZGVkLCB0aGUgdXNlciBjb3VsZCBjbGljayBtdWx0aXBsZVxuICAgKiB0aW1lcyBvbiB0aGUgcGxhY2Ugb3JkZXIgYnV0dG9uIGFuZCB0aGlzIHdvdWxkIGdlbmVyYXRlIG11bHRpcGxlIG9yZGVycy5cbiAgICogVG8gcHJldmVudCB0aGlzIHdlIHN0b3AgZm9ybSBzdWJtaXQgZXZlbnQgcHJvcGFnYXRpb24gYWZ0ZXIgdGhlIGZpcnN0IGNsaWNrLlxuICAgKi9cblxuICBjb25zdCBwbGFjZU9yZGVyQnRuSW5pdGlhbFZhbHVlID0gJCgnI3BsYWNlX29yZGVyJykucHJvcCgndmFsdWUnKTtcbiAgJCgnI3BsYWNlX29yZGVyJykuY2xpY2soZnVuY3Rpb24gZGlzYWJsZVN1Ym1pdE9yZGVyKGUpIHtcbiAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnZGlzYWJsZWQnKSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAkKCcjcGxhY2Vfb3JkZXInKS5wcm9wKCd2YWx1ZScsICdJaHJlIEJlc3RlbGx1bmcgd2lyZCBqZXR6dCB2ZXJhcmJlaXRldOKApicpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICB9KTtcbiAgJChkb2N1bWVudC5ib2R5KS5vbignY2hlY2tvdXRfZXJyb3InLCAoKSA9PiB7XG4gICAgJCgnI3BsYWNlX29yZGVyJykucHJvcCgndmFsdWUnLCBwbGFjZU9yZGVyQnRuSW5pdGlhbFZhbHVlKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgfSk7XG5cbiAgY29uc3QgJHZhcmlhdGlvbnNGb3JtID0gJCgnLnZhcmlhdGlvbnNfZm9ybScpO1xuICBjb25zdCAkdmFyaWF0aW9uc1NlbGVjdERyb3Bkb3ducyA9ICQoJy52YXJpYXRpb25zX2Zvcm0gLnZhcmlhdGlvbnMgc2VsZWN0Jyk7XG4gIGxldCAkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZCA9IGZhbHNlO1xuXG4gICR2YXJpYXRpb25zU2VsZWN0RHJvcGRvd25zLmNoYW5nZShmdW5jdGlvbiB2YXJpYXRpb25TZWxlY3REcm9wZG93bkNoYW5nZWQoKSB7XG4gICAgJHZhcmlhdGlvblNlbGVjdENoYW5nZWQgPSAkKHRoaXMpO1xuICB9KTtcblxuICAkKCcudmFyaWF0aW9uc19mb3JtJykub24oJ3dvb2NvbW1lcmNlX3ZhcmlhdGlvbl9oYXNfY2hhbmdlZCcsICgpID0+IHtcbiAgICAvLyBBbGxvdyBzZWxlY3RpbmcgdGhlIGRlZmF1bHQgZW1wdHkgdmFsdWUgb2YgYW4gYXR0cmlidXRlcyBkcm9wZG93blxuICAgIC8vIHdpdGhvdXQgbW9kaWZ5aW5nIHRoZSB2YWx1ZSBvZiB0aGUgb3RoZXJzLlxuICAgIGlmICgkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZCAmJiAkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZC52YWwoKSA9PT0gJycpIHtcbiAgICAgICR2YXJpYXRpb25TZWxlY3RDaGFuZ2VkLnZhbCgnJyk7XG4gICAgICAkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZCA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJZiB0aGVyZSBpcyBvbmx5IG9uZSBvcHRpb24gbGVmdCBpbiBhbnkgb2YgY3VycmVudCB2YXJpYXRpb24gYXR0cmlidXRlc1xuICAgICAgLy8gZHJvcGRvd25zLCBpdCBzaG91bGQgYmUgYXV0by1zZWxlY3RlZC5cbiAgICAgICR2YXJpYXRpb25zU2VsZWN0RHJvcGRvd25zLmVhY2goZnVuY3Rpb24gc2V0VmFyaWF0aW9uU2VsZWN0RHJvcGRvd25zKCkge1xuICAgICAgICBjb25zdCAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgIGlmICgkdGhpcy5maW5kKCdvcHRpb24nKS5zaXplKCkgPT09IDIpIHtcbiAgICAgICAgICAkdGhpcy52YWwoJHRoaXMuZmluZCgnb3B0aW9uJykuZXEoMSkudmFsKCkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gRW5zdXJlIHRoZSByaWd0aCBwcm9kdWN0IGltYWdlIGlzIGRpc3BsYXllZC5cbiAgICAvLyBTb21lIGRlbGF5IHNlZW1zIHRvIGJlIG5lZWRlZCB0byByZWZyZXNoIHRoZSBwcm9kdWN0IGltYWdlLlxuICAgIC8vIFdlIGNvdWxkbid0IGZpbmQgYSBwcm9wZXIgZXZlbnQgdG8gaG9vayBvbiwgc28gd2UgdXNlZCBhIHRpbWVvdXQuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAkdmFyaWF0aW9uc0Zvcm0udHJpZ2dlcignY2hlY2tfdmFyaWF0aW9ucycpO1xuICAgIH0sIDEwMCk7XG4gIH0pO1xuXG4gICQoJy5zaW5nbGVfdmFyaWF0aW9uX3dyYXAnKVxuICAgIC5vbignc2hvd192YXJpYXRpb24nLCAoZXZlbnQsIHZhcmlhdGlvbikgPT4ge1xuICAgICAgLy8gVXBkYXRlcyBkaXNjb3VudCB0YWJsZSBvbiBwcm9kdWN0IHZhcmlhdGlvbiBjaGFuZ2UuXG4gICAgICAkKCdbZGF0YS12YXJpYXRpb25zXScpLnBhcmVudCgpLmhpZGUoKTtcbiAgICAgICQoJCgnW2RhdGEtdmFyaWF0aW9uc10nKSkuZWFjaChmdW5jdGlvbiB1cGRhdGVEaXNjb3VudFRhYmxlKCkge1xuICAgICAgICBpZiAoJCh0aGlzKS5kYXRhKCd2YXJpYXRpb25zJykuaW5kZXhPZih2YXJpYXRpb24udmFyaWF0aW9uX2lkLnRvU3RyaW5nKCkpICE9PSAtMSkge1xuICAgICAgICAgICQodGhpcykucGFyZW50KCkuc2hvdygpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KVxuICAgIC5vbignaGlkZV92YXJpYXRpb24nLCAoKSA9PiB7XG4gICAgICAvLyBIaWRlcyBhbGwgdmFyaWF0aW9uIHByb2R1Y3QgZGlzY291bnQgdGFibGUgb24gcHJvZHVjdCB2YXJpYXRpb24gaGlkZS5cbiAgICAgICQoJCgnW2RhdGEtdmFyaWF0aW9uc10nKSkuZWFjaChmdW5jdGlvbiBoaWRlRGlzY291bnRUYWJsZSgpIHtcbiAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5oaWRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAkKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgLy8gRGlzYWJsZSBjb3B5L3Bhc3RlIGFjdGlvbnMgb24gYmlsbGluZyBlbWFpbCBmaWVsZHMuXG4gICAgaWYgKHNob3Bfc3RhbmRhcmRzX3NldHRpbmdzLmVtYWlsQ29uZmlybWF0aW9uRW1haWwgPT09ICd5ZXMnKSB7XG4gICAgICAkKCcjYmlsbGluZ19lbWFpbCwgI2JpbGxpbmdfZW1haWxfY29uZmlybWF0aW9uJykub24oJ2N1dCBjb3B5IHBhc3RlJywgKGUpID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIE1hcmtzIGVtYWlsIGNvbmZpcm1hdGlvbiBmaWVsZCBhcyBpbnZhbGlkIGlmIGRvZXMgbm90IG1hdGNoIGVtYWlsXG4gICAgICAvLyBmaWVsZCBvbiBmb3JtIHN1Ym1pdC5cbiAgICAgICQoJ2Zvcm0ud29vY29tbWVyY2UtY2hlY2tvdXQnKS5vbignaW5wdXQgdmFsaWRhdGUgY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICBpZiAoJCgnI2JpbGxpbmdfZW1haWwnKS52YWwoKSAhPT0gJCgnI2JpbGxpbmdfZW1haWxfY29uZmlybWF0aW9uJykudmFsKCkpIHtcbiAgICAgICAgICAkKCcjYmlsbGluZ19lbWFpbF9jb25maXJtYXRpb25fZmllbGQnKS5yZW1vdmVDbGFzcygnd29vY29tbWVyY2UtdmFsaWRhdGVkJykuYWRkQ2xhc3MoJ3dvb2NvbW1lcmNlLWludmFsaWQgd29vY29tbWVyY2UtaW52YWxpZC1yZXF1aXJlZC1maWVsZCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIERpc2FibGUgY2hlY2tvdXQgYnV0dG9uIGlmIGNhcnQgb25seSBjb250YWlucyBsb3cgcmV0dXJuIHByb2R1Y3RzLlxuICAkKGRvY3VtZW50KS5vbigncmVhZHkgdXBkYXRlZF9jYXJ0X3RvdGFscycsICgpID0+IHtcbiAgICBpZiAoJCgnLndvb2NvbW1lcmNlLWVycm9yIGxpW2RhdGEtcGx1cy1wcm9kdWN0PVwiaW52YWxpZFwiXScpLmxlbmd0aCkge1xuICAgICAgJCgnLmNoZWNrb3V0LWJ1dHRvbicpLnJlbW92ZUF0dHIoJ2hyZWYnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICQoJy53Y3BwZWMtY2hlY2tvdXQtYnV0dG9ucycpLmhpZGUoKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIFVzZWQgYW5kIGRlZmVjdGl2ZSBnb29kcyBjaGVja2JveCBhZ3JlZW1lbnQgcmVsYXRlZCBmdW5jdGlvbmFsaXR5LlxuICAkKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgY29uc3QgJHVzZWRHb29kc0NvbnNlbnRDaGVja2JveCA9ICQoJyN1c2VkLWdvb2RzLWNvbnNlbnQnKTtcbiAgICBjb25zdCAkdXNlZEdvb2RzQ29uc2VudENvbnRhaW5lciA9ICQoJy5wcm9kdWN0LWRlZmVjdHNfX2NoZWNrYm94LWNvbnRhaW5lcicpO1xuICAgIGlmICgkdXNlZEdvb2RzQ29uc2VudENoZWNrYm94Lmxlbmd0aCkge1xuICAgICAgJChkb2N1bWVudClcbiAgICAgICAgLm9uKCdzaG93X3ZhcmlhdGlvbicsICcuc2luZ2xlX3ZhcmlhdGlvbl93cmFwJywgKGV2ZW50LCB2YXJpYXRpb24pID0+IHtcbiAgICAgICAgICBjb25zdCB1c2VkR29vZHNDb25zZW50QXR0ciA9IHZhcmlhdGlvbi51c2VkX2dvb2RzX2NvbnNlbnRfYXR0cmlidXRlO1xuICAgICAgICAgICQoJy5wcm9kdWN0LWRlZmVjdHNfX2F0dHJpYnV0ZScpLnRleHQodXNlZEdvb2RzQ29uc2VudEF0dHIpO1xuICAgICAgICAgIGlmICh1c2VkR29vZHNDb25zZW50QXR0cikge1xuICAgICAgICAgICAgJHVzZWRHb29kc0NvbnNlbnRDb250YWluZXIuc2hvdygpO1xuICAgICAgICAgICAgJHVzZWRHb29kc0NvbnNlbnRDaGVja2JveC5wcm9wKCdyZXF1aXJlZCcsICdyZXF1aXJlZCcpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkdXNlZEdvb2RzQ29uc2VudENvbnRhaW5lci5oaWRlKCk7XG4gICAgICAgICAgICAkdXNlZEdvb2RzQ29uc2VudENoZWNrYm94LnJlbW92ZUF0dHIoJ3JlcXVpcmVkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIEFkZCBhamF4IGFkZCB0byBjYXJ0XG4gICQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcbiAgICAkKCdib2R5LmN1c3RvbS1hamF4LWNhcnQtYWN0aXZlIC5zaW5nbGVfYWRkX3RvX2NhcnRfYnV0dG9uJykuY2xpY2soKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGlmICgkKGUudGFyZ2V0KS5oYXNDbGFzcygnbG9hZGluZycpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0ICR0aGlzYnV0dG9uID0gJChlLnRhcmdldCk7XG4gICAgICBjb25zdCAkZm9ybSA9ICR0aGlzYnV0dG9uLmNsb3Nlc3QoJ2Zvcm0uY2FydCcpO1xuICAgICAgY29uc3QgaWQgPSAkdGhpc2J1dHRvbi52YWwoKTtcbiAgICAgIGNvbnN0IHByb2R1Y3RRdHkgPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPXF1YW50aXR5XScpLnZhbCgpIHx8IDE7XG4gICAgICBjb25zdCBwcm9kdWN0SWQgPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPXByb2R1Y3RfaWRdJykudmFsKCkgfHwgaWQ7XG4gICAgICBjb25zdCB2YXJpYXRpb25JZCA9ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9dmFyaWF0aW9uX2lkXScpLnZhbCgpIHx8IDA7XG4gICAgICBjb25zdCBwcm9kdWN0VHlwZSA9ICRmb3JtLmhhc0NsYXNzKCd2YXJpYXRpb25zX2Zvcm0nKSA/ICd2YXJpYWJsZScgOiAnc2ltcGxlJztcbiAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgIGFjdGlvbjogJ3dvb2NvbW1lcmNlQWpheEFkZFRvQ2FydCcsXG4gICAgICAgIHByb2R1Y3RfaWQ6IHByb2R1Y3RJZCxcbiAgICAgICAgcHJvZHVjdF9za3U6ICcnLFxuICAgICAgICBxdWFudGl0eTogcHJvZHVjdFF0eSxcbiAgICAgICAgdmFyaWF0aW9uX2lkOiB2YXJpYXRpb25JZCxcbiAgICAgICAgcHJvZHVjdF90eXBlOiBwcm9kdWN0VHlwZSxcbiAgICAgICAgbm9uY2U6IHNob3Bfc3RhbmRhcmRzX3NldHRpbmdzLmFqYXhfbm9uY2UsXG4gICAgICB9O1xuICAgICAgJC5hamF4KHtcbiAgICAgICAgdHlwZTogJ3Bvc3QnLFxuICAgICAgICB1cmw6IHNob3Bfc3RhbmRhcmRzX3NldHRpbmdzLmFqYXhfdXJsLFxuICAgICAgICBkYXRhLFxuICAgICAgICBiZWZvcmVTZW5kKCkge1xuICAgICAgICAgICR0aGlzYnV0dG9uLmFkZENsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBsZXRlKCkge1xuICAgICAgICAgICR0aGlzYnV0dG9uLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe1xuICAgICAgICAgICAgc2Nyb2xsVG9wOiAwXG4gICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgfSxcbiAgICAgICAgc3VjY2VzcyhyZXNwb25zZSkge1xuICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvciAmJiByZXNwb25zZS5wcm9kdWN0X3VybCkge1xuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gcmVzcG9uc2UucHJvZHVjdF91cmw7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSkudHJpZ2dlcignYWRkZWRfdG9fY2FydCcsIFtyZXNwb25zZS5mcmFnbWVudHMsIHJlc3BvbnNlLmNhcnRfaGFzaCwgJHRoaXNidXR0b25dKTtcbiAgICAgICAgICAgICQoJy53b29jb21tZXJjZS1lcnJvciwgLndvb2NvbW1lcmNlLW1lc3NhZ2UsIC53b29jb21tZXJjZS1pbmZvLCAucmVsYXRlZC1hY2Nlc3NvcmllcycpLnJlbW92ZSgpO1xuICAgICAgICAgICAgJGZvcm0uY2xvc2VzdCgnLnByb2R1Y3QnKS5iZWZvcmUocmVzcG9uc2UuZnJhZ21lbnRzLm5vdGljZXNfaHRtbCk7XG4gICAgICAgICAgICBpZiAoISQocmVzcG9uc2UuZnJhZ21lbnRzLm5vdGljZXNfaHRtbCkuaGFzQ2xhc3MoJ3dvb2NvbW1lcmNlLWVycm9yJykpIHtcbiAgICAgICAgICAgICAgJGZvcm0uY2xvc2VzdCgnLnByb2R1Y3QnKS5iZWZvcmUocmVzcG9uc2UuZnJhZ21lbnRzLmFjY2Vzc29yaWVzX2h0bWwpO1xuICAgICAgICAgICAgICAkKGRvY3VtZW50KS50cmlnZ2VyKCdyZWxvYWRSZWxhdGVkQWNjZXNzb3JpZXMnKTtcbiAgICAgICAgICAgICAgJChkb2N1bWVudCkudHJpZ2dlcigncmVsb2FkR2FsbGVyeWFTbGlkZXInKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgkKCdzcGFuLmhlYWRlci1pdGVtLS1jYXJ0X19hbW91bnQnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgJCgnc3Bhbi5oZWFkZXItaXRlbS0tY2FydF9fYW1vdW50JykuaHRtbCgkKHJlc3BvbnNlLmZyYWdtZW50c1snc3Bhbi5oZWFkZXItaXRlbS0tY2FydF9fYW1vdW50J10pLmh0bWwoKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAkKCdidXR0b24uaGVhZGVyLWl0ZW0tLWNhcnQnKS5hcHBlbmQoJChyZXNwb25zZS5mcmFnbWVudHNbJ3NwYW4uaGVhZGVyLWl0ZW0tLWNhcnRfX2Ftb3VudCddKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufShqUXVlcnkpKTtcbiJdLCJmaWxlIjoibWFpbi5qcyJ9